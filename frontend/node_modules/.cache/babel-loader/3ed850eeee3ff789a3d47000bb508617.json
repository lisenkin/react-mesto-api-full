{"ast":null,"code":"import _toConsumableArray from\"/home/lisena/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/lisena/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/lisena/react-mesto-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import{useState,useEffect}from'react';import{CurrentUserContext}from'../contexts/CurrentUserContext.js';import'../index.css';import Header from'./Header.js';import Footer from'./Footer.js';import Main from'./Main.js';import PopupWithForm from'./PopupWithForm.js';import ImagePopup from'./ImagePopup.js';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import AddPlacePopup from'./AddPlacePopup';import api from'../utils/api.js';//new parts\nimport Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute\";import InfoTooltip from\"./InfoTooltip\";import{Route,Switch,Redirect,useHistory}from'react-router-dom';import*as auth from'../utils/auth';//попробуем так\n//скакать туда-сюда по репам не оч удобно :)\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState({name:\"Loading...\",about:''}),_useState2=_slicedToArray(_useState,2),currentUser=_useState2[0],setCurrentUser=_useState2[1];// + mail + loggedIn\nvar _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState({isOpen:false}),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),cards=_useState4[0],setCards=_useState4[1];//const [isLoading, setIsLoading] = useState(false); выключим на время\nvar _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),loggedIn=_React$useState10[0],setLoggedIn=_React$useState10[1];var _React$useState11=React.useState(''),_React$useState12=_slicedToArray(_React$useState11,2),email=_React$useState12[0],setEmail=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isInfoTooltipOpen=_React$useState14[0],setIsInfoTooltipOpen=_React$useState14[1];var history=useHistory();var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),isSuccess=_React$useState16[0],setSuccess=_React$useState16[1];// загрузим данные\nReact.useEffect(function(){if(loggedIn){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cards=_ref2[1];setCurrentUser(userData.data);setCards(cards.data);}).catch(function(err){console.log(\"\\u0414\\u0430\\u043D\\u043D\\u044B\\u0435 \\u0441 \\u0441\\u0435\\u0440\\u0432\\u0435\\u0440\\u0430 \\u043D\\u0435 \\u043F\\u043E\\u043B\\u0443\\u0447\\u0435\\u043D\\u044B. \\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err,\".\"));});}},[loggedIn]);React.useEffect(function(){if(loggedIn){history.push('/');}},[loggedIn,history]);//закрытие всех попапов (установим всем фолс)\nfunction closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setSelectedCard({isOpen:false});//сбросим\nsetIsInfoTooltipOpen(false);}//эдит профиль\nvar handleEditProfileClick=function handleEditProfileClick(){setIsEditProfilePopupOpen(true);};//добавить место\nvar handleAddPlaceClick=function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);};//аватарка\nvar handleEditAvatarClick=function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);};// большая картинка\nvar handleCardClick=function handleCardClick(data){setSelectedCard(_objectSpread({isOpen:true},data));};//лайк с переделанным апи\nfunction handleCardLike(card){var isLiked=card.likes.some(function(item){return item===currentUser._id;});api.changeLikeCardStatus(card._id,isLiked).then(function(res){var newCards=cards.map(function(item){return item._id===card._id?res:item;});setCards(newCards);}).catch(function(err){return console.log(\"Error: \".concat(err));});}//удалить карточку (свою)\nfunction handleCardDelete(card){api.removeCard(card._id).then(function(res){var newCards=cards.filter(function(item){return item===card?null:item;});setCards(newCards);}).catch(function(err){return console.log(\"Error: \".concat(err));});}//обновим юзер инфо на новую\nfunction handleUpdateUser(data){api.setUserInfo(data).then(function(res){setCurrentUser(res.data);closeAllPopups();}).catch(function(err){return console.log(\"Error: \".concat(err));});}//обновим аватар\nfunction handleUpdateAvatar(data){api.editUserAvatar(data).then(function(avatar){setCurrentUser(avatar);closeAllPopups();}).catch(function(err){return console.log(\"Error: \".concat(err));});}//добавить карточку\nfunction handleAddPlaceSubmit(data){api.setCard(data).then(function(res){setCards([res.data].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(\"Error: \".concat(err));});}//регистрация\nfunction handleRegister(email,password){auth.register(email,password).then(function(data){if(data){setSuccess(true);setIsInfoTooltipOpen(true);history.push(\"/sign-in\");}}).catch(function(err){console.error(err);setSuccess(false);setIsInfoTooltipOpen(true);});}//логин\nfunction handleLogin(email,password){auth.authorize(email,password).then(function(data){if(data){localStorage.setItem('jwt',data.token);setEmail(email);setLoggedIn(true);history.push(\"/\");}}).catch(function(err){console.error(err);setIsInfoTooltipOpen(true);setSuccess(false);});}//логаут\nfunction handleLogout(){localStorage.removeItem('jwt');setEmail('');setLoggedIn(false);history.push('/sign-in');}useEffect(function(){function checkToken(){//возьмем из jwt\nvar jwt=localStorage.getItem(\"jwt\");if(jwt){auth.checkToken(jwt).then(function(data){if(data){setEmail(data.email);setLoggedIn(true);history.push(\"/\");}else{setSuccess(false);setIsInfoTooltipOpen(true);}}).catch(function(err){console.error(err);setSuccess(false);setIsInfoTooltipOpen(true);});}}checkToken();},[history]);return/*#__PURE__*/_jsx(\"div\",{className:\"page__content\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{loggedIn:loggedIn,email:email,onSignout:handleLogout}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,loggedIn:loggedIn}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegister})}),/*#__PURE__*/_jsxs(Route,{children:[\" \",loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})]})]}),/*#__PURE__*/_jsx(Footer,{text:\"2021 mesto lisenkin\"}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"popup-remove-card\",title:\"\\u0412\\u044B \\u0443\\u0432\\u0435\\u0440\\u0435\\u043D\\u044B?\",textButton:\"\\u0414\\u0430\"}),/*#__PURE__*/_jsx(ImagePopup,{isOpen:selectedCard,card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,success:isSuccess,onClose:closeAllPopups})]})});}export default App;","map":{"version":3,"sources":["/home/lisena/react-mesto-api-full/frontend/src/components/App.js"],"names":["React","useState","useEffect","CurrentUserContext","Header","Footer","Main","PopupWithForm","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","api","Login","Register","ProtectedRoute","InfoTooltip","Route","Switch","Redirect","useHistory","auth","App","name","about","currentUser","setCurrentUser","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isOpen","selectedCard","setSelectedCard","cards","setCards","loggedIn","setLoggedIn","email","setEmail","isInfoTooltipOpen","setIsInfoTooltipOpen","history","isSuccess","setSuccess","Promise","all","getUserInfo","getInitialCards","then","userData","data","catch","err","console","log","push","closeAllPopups","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleCardClick","handleCardLike","card","isLiked","likes","some","item","_id","changeLikeCardStatus","res","newCards","map","handleCardDelete","removeCard","filter","handleUpdateUser","setUserInfo","handleUpdateAvatar","editUserAvatar","avatar","handleAddPlaceSubmit","setCard","handleRegister","password","register","error","handleLogin","authorize","localStorage","setItem","token","handleLogout","removeItem","checkToken","jwt","getItem"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { useState, useEffect } from 'react';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext.js'\nimport '../index.css';\nimport Header from './Header.js';\nimport Footer from './Footer.js';\nimport Main from './Main.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport ImagePopup from './ImagePopup.js';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport AddPlacePopup from './AddPlacePopup';\nimport api from '../utils/api.js'\n//new parts\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute\";\nimport InfoTooltip from \"./InfoTooltip\";\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport * as auth from '../utils/auth';\n\n\n\n//попробуем так\n//скакать туда-сюда по репам не оч удобно :)\nfunction App() {\n  const [currentUser, setCurrentUser] = useState({\n    name: \"Loading...\",\n    about: ''\n  });\n  // + mail + loggedIn\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({ isOpen: false });\n  const [cards, setCards] = useState([]);\n  //const [isLoading, setIsLoading] = useState(false); выключим на время\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n  const history = useHistory();\n  const [isSuccess, setSuccess] = React.useState(false);\n\n  // загрузим данные\nReact.useEffect(() => {\n  if (loggedIn) {\n    Promise.all([api.getUserInfo(), api.getInitialCards()])\n      .then(([userData, cards]) => {\n        setCurrentUser(userData.data)\n        setCards(cards.data)\n      })\n      .catch(err => {\n        console.log(`Данные с сервера не получены. Ошибка: ${err}.`)\n      })\n  }\n}, [loggedIn])\n\nReact.useEffect(() => {\n  if (loggedIn) {\n    history.push('/')\n  }\n}, [loggedIn, history])\n\n  //закрытие всех попапов (установим всем фолс)\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false)\n    setIsAddPlacePopupOpen(false)\n    setIsEditAvatarPopupOpen(false)\n    setSelectedCard({ isOpen: false });  //сбросим\n    setIsInfoTooltipOpen(false);\n  }\n\n\n  //эдит профиль\n  const handleEditProfileClick = () => { setIsEditProfilePopupOpen(true) }\n  //добавить место\n  const handleAddPlaceClick = () => { setIsAddPlacePopupOpen(true) }\n  //аватарка\n  const handleEditAvatarClick = () => { setIsEditAvatarPopupOpen(true) }\n  // большая картинка\n  const handleCardClick = (data) => { setSelectedCard({ isOpen: true, ...data }) }\n\n  //лайк с переделанным апи\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(item => item === currentUser._id);\n\n    api.changeLikeCardStatus(card._id, isLiked)\n      .then(res => {\n        const newCards = cards.map(item => item._id === card._id ? res : item);\n        setCards(newCards);\n      })\n      .catch(err => console.log(`Error: ${err}`));\n  }\n  //удалить карточку (свою)\n  function handleCardDelete(card) {\n    api.removeCard(card._id)\n      .then(res => {\n        const newCards = cards.filter(item => item === card ? null : item);\n        setCards(newCards);\n      })\n      .catch(err => console.log(`Error: ${err}`));\n  }\n  //обновим юзер инфо на новую\n  function handleUpdateUser(data) {\n    api.setUserInfo(data)\n      .then(res => {\n        setCurrentUser(res.data);\n        closeAllPopups();\n      })\n      .catch(err => console.log(`Error: ${err}`));\n  }\n  //обновим аватар\n  function handleUpdateAvatar(data) {\n    api.editUserAvatar(data)\n      .then(avatar => {\n        setCurrentUser(avatar);\n        closeAllPopups();\n      })\n      .catch(err => console.log(`Error: ${err}`));\n  }\n\n  //добавить карточку\n  function handleAddPlaceSubmit(data) {\n    api.setCard(data)\n      .then(res => {\n        setCards([res.data, ...cards]);\n        closeAllPopups();\n      })\n      .catch(err => console.log(`Error: ${err}`));\n  }\n//регистрация\n  function handleRegister(email, password) {\n    auth.register(email, password)\n      .then((data) => {\n        if (data){\n        setSuccess(true);\n        setIsInfoTooltipOpen(true);\n        history.push(\"/sign-in\");\n        }\n      })\n\n      .catch((err) => {\n        console.error(err);\n        setSuccess(false);\n        setIsInfoTooltipOpen(true);\n      });\n  }\n//логин\n  function handleLogin(email, password) {\n\n      auth.authorize(email, password)\n      .then((data) => {\n        if (data) {\n        localStorage.setItem('jwt', data.token);\n        setEmail(email);\n        setLoggedIn(true);\n        history.push(\"/\");\n        }\n      })\n      .catch((err) => {\n        console.error(err);\n        setIsInfoTooltipOpen(true);\n        setSuccess(false);\n      });\n  }\n//логаут\n  function handleLogout() {\n    localStorage.removeItem('jwt');\n    setEmail('');\n    setLoggedIn(false);\n    history.push('/sign-in');\n  }\n\n  useEffect(() => {\n  function checkToken() {\n    //возьмем из jwt\n    const jwt = localStorage.getItem(\"jwt\");\n    if (jwt) {\n      auth\n        .checkToken(jwt)\n        .then((data) => {\n          if (data) {\n            setEmail(data.email);\n            setLoggedIn(true);\n            history.push(\"/\");\n          } else {\n            setSuccess(false);\n            setIsInfoTooltipOpen(true);\n          }\n        })\n        .catch((err) => {\n          console.error(err);\n          setSuccess(false);\n          setIsInfoTooltipOpen(true);\n        })\n    }\n  }\n  checkToken();\n},[history]);\n\n\n  return (\n    <div className=\"page__content\">\n      <CurrentUserContext.Provider value={currentUser}>\n        <Header loggedIn={loggedIn} email={email} onSignout={handleLogout} />\n        <Switch>\n          <ProtectedRoute exact\n            path=\"/\"\n            component={Main}\n            onEditAvatar={handleEditAvatarClick}\n            onEditProfile={handleEditProfileClick}\n            onAddPlace={handleAddPlaceClick}\n            onCardClick={handleCardClick}\n            onCardLike={handleCardLike}\n            onCardDelete={handleCardDelete}\n            cards={cards}\n            loggedIn={loggedIn}\n          />\n          <Route path='/sign-in'>\n            <Login onLogin={handleLogin} />\n          </Route>\n          <Route path='/sign-up'>\n            <Register onRegister={handleRegister} />\n          </Route>\n          <Route> {loggedIn ? <Redirect to=\"/\" /> : <Redirect to=\"/sign-in\" />}</Route>\n        </Switch>\n\n        <Footer text=\"2021 mesto lisenkin\" />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n        />\n\n        <AddPlacePopup\n          isOpen={isAddPlacePopupOpen}\n          onClose={closeAllPopups}\n          onAddPlace={handleAddPlaceSubmit}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n\n        <PopupWithForm\n          name=\"popup-remove-card\"\n          title=\"Вы уверены?\"\n          textButton=\"Да\"\n        />\n\n        <ImagePopup\n          isOpen={selectedCard}\n          card={selectedCard}\n          onClose={closeAllPopups}\n        />\n        <InfoTooltip\n          isOpen={isInfoTooltipOpen}\n          success={isSuccess}\n          onClose={closeAllPopups} />\n      </CurrentUserContext.Provider>\n    </div>\n\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}